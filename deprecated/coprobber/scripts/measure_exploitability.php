#!/usr/local/bin/php
<?php

if( $argc < 3 ) {
	echo "Syntax: " . $argv[0] . " <best response file> <dijkstra file>\n";
	exit( 1 );
}

$fbestres  = fopen( $argv[1], "r" );
$fdijkstra = fopen( $argv[2], "r" );

fscanf( $fbestres, "states in space: %d\n", &$states1 );
fscanf( $fdijkstra, "states in space: %d\n", &$states2 );

if( $states1 != $states2 ) {
	echo "ERROR: these files do not belong to the same map.\n";
	exit( 1 );
}

fgets( $fbestres  ); fgets( $fbestres  ); fgets( $fbestres  );
fgets( $fdijkstra ); fgets( $fdijkstra ); fgets( $fdijkstra );

$exploitability_sum = 0.;
$exploitability_count = 0;

while( !feof( $fdijkstra ) && !feof( $fbestres ) ) {
	fscanf( $fbestres,  "%d %d %d\n", &$br_r, &$br_c, &$br_v );
	fscanf( $fdijkstra, "%d %d %d\n", &$di_r, &$di_c, &$di_v );

	if( $br_r != $di_r || $br_c != $di_c ) {
		echo "ERROR: positions in file did not match\n";
		exit( 1 );
	}

	if( $br_v > $di_v ) {
		echo "ERROR: computation cannot be right.\n";
		exit( 1 );
	}

	if( $di_v > 1 ) {
		// verbose
		//if( $br_v != $di_v )
		//	echo "including state: ($br_r,$br_c) $br_v/$di_v\n";
		$exploitability_sum += (double)$br_v / (double)$di_v;
		$exploitability_count += 1;
	}
}

fclose( $fbestres );
fclose( $fdijkstra );

echo "exploitability is: " . (1.-$exploitability_sum/(double)$exploitability_count) . "\n";

?>
